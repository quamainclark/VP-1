{
  "version": "2.1",
  "jobs": {
    "build": {
      "docker": [
        {"image": "circleci/rust:latest"}
      ],
      "steps": [
        "checkout",
        {"restore_cache": {
          "key": "v1-cargo-cache-{{ checksum \"Cargo.lock\" }}"
        }},
        {"run": "cargo build --lib"},
        {"save_cache": {
          "paths": [
            "/usr/local/cargo/registry",
            "target/"
          ],
          "key": "v1-cargo-cache-{{ checksum \"Cargo.lock\" }}"
        }}
      ]
    },

    "test": {
      "docker": [
        {"image": "circleci/rust:latest"}
      ],
      "steps": [
        "checkout",
        {"restore_cache": {
          "key": "v1-cargo-cache-{{ checksum \"Cargo.lock\" }}"
        }},
        {"run": "cargo test --lib"},
      ]
    },

    "warnings": {
      "docker": [
        {"image": "circleci/rust:latest"}
      ],
      "steps": [
        "checkout",
        {"restore_cache": {
          "key": "v1-cargo-cache-{{ checksum \"Cargo.lock\" }}"
        }},
        {"run": "RUSTFLAGS=\"-D warnings\" cargo build --lib"},
      ]
    }
  }
}
